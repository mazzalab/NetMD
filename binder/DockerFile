# .binder/Dockerfile

# 1. Start from Miniconda
FROM continuumio/miniconda3

# 2. Copy in your conda-recipe and source so we can build the package
#    Binder’s build context is the repo root, so these paths match your repo layout.
COPY ../conda-recipe        /tmp/conda-recipe
COPY ../setup.py            /tmp/setup.py
COPY ../netmd               /tmp/netmd
COPY ../conf                /tmp/conf
COPY ../example             /tmp/example
COPY ../docs                /tmp/docs
COPY ../README.md           /tmp/README.md

# 3. Install conda-build and JupyterLab (so Binder will detect & launch a notebook)
#    Clean up caches to keep the image lean.
RUN conda install --yes conda-build jupyterlab \
 && conda clean --all --yes :contentReference[oaicite:0]{index=0}

# 4. Build your NetMD package from the recipe
#    This reads meta.yaml (and setup.py) to install everything under `run:`
RUN conda-build /tmp/conda-recipe --output-folder /tmp/conda-bld \
 && conda install --yes --use-local netmd \
 && conda clean --all --yes :contentReference[oaicite:1]{index=1}

# 5. Copy the full repo into the default jovyan home (so notebooks, examples, config, etc. are available)
COPY . /home/jovyan

# 6. Create a non-root user (UID 1000) for Binder’s security model, switch to it
ARG NB_USER=jovyan
ARG NB_UID=1000
RUN useradd --uid ${NB_UID} --create-home ${NB_USER}
USER ${NB_USER}
WORKDIR /home/${NB_USER}

# 7. Allow repo2docker to append the Jupyter launch command
ENTRYPOINT []
